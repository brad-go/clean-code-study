# Emergence

## 창발성

---

- 자기 조직화 현상
- 하위 계층에는 없는 특성이나 행동이 상위 계층에서 자발적으로 돌연히 출연하는 현상

## 창발적 설계로 깔끔한 코드를 구현하자

---

### 켄트 벡이 제시한 단순한 설계 규칙 중요도 순 4가지

1. 모든 테스트를 실행한다.
2. 중복을 없앤다.
3. 프로그래머 의도를 표현한다.
4. 클래스와 메서드 수를 최소로 줄인다.

- 코드 구조와 설계를 파악하기 쉬워진다.
- SRP나 DIP와 같은 원칙을 적용하기 쉬워진다.
- 소프트웨어 설계 품질을 크게 높여준다.

## 단순한 설계 규칙 1: 모든 테스트를 실행하라

---

- 테스트를 철저히 거쳐 모든 테스트 케이스를 항상 통과하는 시스템은 ‘테스트가 가능한 시스템’ 이다.
- 테스트 케이스가 많을수록 개발자는 테스트가 쉽게 코드를 작성한다.
- 테스트 케이스를 많이 작성할수록 개발자는 DIP와 같은 원칙을 저굥하고 의존성 주입, 인터페이스, 추상화 등과 같은 도구를 사용해 결합도를 낮춘다.
- 테스트 케이스를 작성하면 설계 품질이 높아진다.

## 단순한 설계 규칙 2-4: 리팩터링

---

- 테스트 케이스를 모두 작성했다면 이제 코드와 클래스를 정리한다. → 테스트 케이스가 존재하기 떄문에 시스템이 깨지지 않는다.
- 리팩터링 단계에서는 소프트웨어 설계 품질을 높이는 기법이라면 무엇이든 적용해도 괜찮다.
- 응집도를 높이고, 결합도를 낮추고, 관심사를 분리하고, 시스템 관심사를 모듈로 나누고, 함수와 클래스 크기를 줄이고, 더나은 이름을 선택하는 등 다양한 기법을 동원한다.

## 중복을 없애라

---

- 우수한 설계에서 중복은 커다란 적이다.
- 중복은 추가 작업, 추가 위험, 불필요한 복잡도를 뜻하기 때문이다.

```java
// size()가 개수를 반환하는 로직이기 떄문에 isEmpty는 중복이다.
int size() {}
boolean isEmpty{}
```

- 깔끔한 시스템을 만들려면 단 몇 줄이라도 중복을 제거하겠다는 의지가 필요하다.

```java
boolean isEmpty() {
  return 0 == size();
}
```

- `'소규모 재사용'은 시스템 복잡도를 극적으로 줄여준다. 소규모 재사용을 제대로 익혀야 대규모 재사용이 가능하다.`
- TEMPLATE METHOD 패턴

```java
public class VacationPolicy {
  public void accrueUSDDivisionVacation() {
    // 지금까지 근무한 시간을 바탕으로 휴가 일수를 계산하는 코드
    // ...
    // 휴가 일수가 미국 최소 법정 일수를 만족하는지 확인하는 코드
    // ...
    // 휴가 일수를 급여 대장에 적용하는 코드
    // ...
  }

  public void accrueEUDivisionVacation() {
    // 지금까지 근무한 시간을 바탕으로 휴가 일수를 계산하는 코드
    // ...
    // 휴가 일수가 유럽연합 최소 법정 일수를 만족하는지 확인하는 코드
    // ...
    // 휴가 일수를 급여 대장에 적용하는 코드
    // ...
  }
}
```

- 최소 법정 일수를 계산하는 코드만 제외하면 두 메서드는 거의 동일하다.
- 최소 법정 일수를 계산하는 알고리즘은 직원 유형에 따라 살짝 변한다.
- 여기에 TEMPLATE METHOD 패턴을 적용해 눈에 들어오는 중복을 제거

```java
abstract public class VacationPolicy {
  public void accrueVacation() {
    caculateBseVacationHours();
    alterForLegalMinimums();
    applyToPayroll();
  }

  private void calculateBaseVacationHours() { /* ... */ };
  abstract protected void alterForLegalMinimums();
  private void applyToPayroll() { /* ... */ };
}

public class USVacationPolicy extends VacationPolicy {
  @Override protected void alterForLegalMinimums() {
    // 미국 최소 법정 일수를 사용한다.
  }
}

public class EUVacationPolicy extends VacationPolicy {
  @Override protected void alterForLegalMinimums() {
    // 유럽연합 최소 법정 일수를 사용한다.
  }
}
```

## 표현하라

---

- 자신이 이해하는 코드를 짜기는 쉽다.
- 나중에 코드를 유지보수할 사람이 코드를 짜는 사람만큼이나 문제를 깊이 이해할 가능성은 희박하다.
- 시스템이 점차 복잡해지면서 유지보수 개발자가 시스템을 이해하느라 보내는 시간은 점점 늘어나고 동시에 코드를 오해할 가능성도 점점 커진다.
- 개발자 의도 표현하기
  1. 좋은 이름 선택하기
  2. 함수와 클래스 크기를 가능한 줄이기
  3. 표준 명칭을 사용하기
  4. 단위 테스트 케이스를 꼼꼼히 작성하기
  5. 노력하기
- `자신의 작품을 조금 더 자랑하자`

## 클래스와 메서드 수를 최소로 줄여라

---

- 목표는 함수와 클래스 크기를 작게 유지하면서 동시에 시스템 크디고 작게 유지하기

## 결론

---

- 경험을 대신할 단순한 개발기법은 없다.
- 그러나 다른 사람의 경험을 압축하여 경험하고 익힐 수 있다.

## Quiz

- 켄트 벡이 제시한 단순한 설계 규칙 4가지를 중요도 순으로 말해보자.
  1. 모든 테스트를 실행한다.
  2. 중복을 없앤다.
  3. 프로그래머 의도를 표현한다.
  4. 클래스와 메서드 수를 최소로 줄인다
- 이것은 중복을 제거하는 과정이며, 다른 맥락에서 재사용할 기회를 포착하는 것은?
  - 소규모 재사용
